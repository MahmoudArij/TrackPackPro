<!-- index.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TrackPack — Suivi de Colis</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
  :root{
    --bg: #0f1724;
    --card: #0b1220;
    --muted: #9aa6b2;
    --accent: #3b82f6;
    --accent-2: #06b6d4;
    --danger: #ef4444;
    --glass: rgba(255,255,255,0.03);
    --radius: 14px;
    --glass-2: rgba(255,255,255,0.02);
    --white: #e6eef8;
    --soft-shadow: 0 6px 24px rgba(2,6,23,0.6);
    --glass-border: rgba(255,255,255,0.04);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#071029 0%, #071827 50%, #071827 100%);
    color:var(--white);
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    padding-bottom:40px;
  }

  .wrap{max-width:1150px;margin:28px auto;padding:20px;}

  header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:18px;border-radius:12px;background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);border:1px solid var(--glass-border);backdrop-filter: blur(6px);box-shadow:var(--soft-shadow);}
  .brand{display:flex;align-items:center;gap:12px;}
  .brand .logo {width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#04263b;font-size:18px;box-shadow: 0 6px 18px rgba(59,130,246,0.12);}
  .brand h1{font-size:18px;margin:0}
  .controls{display:flex;align-items:center;gap:12px}
  .lang-select{background:var(--glass);border:1px solid var(--glass-border);padding:6px 10px;border-radius:8px;color:var(--white);display:flex;align-items:center;gap:8px;font-weight:600;}
  .lang-select select{background:transparent;border:none;color:var(--white);outline:none;font-weight:600;}

  .hero{margin-top:22px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:36px;border-radius:16px;border:1px solid var(--glass-border);box-shadow:var(--soft-shadow);display:grid;grid-template-columns:1fr 420px;gap:28px;align-items:center;}
  .hero-left{padding:12px;}
  .tag{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03);color:var(--muted);font-size:13px;margin-bottom:16px;}
  .hero-left h2{font-size:28px;margin:8px 0 12px;color:var(--white);line-height:1.05}
  .hero-left p{margin:0;color:var(--muted);max-width:680px}

  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;border:1px solid var(--glass-border);}
  form.tracking{display:flex;flex-direction:column;gap:12px;}
  .inputs{display:flex;gap:10px;}
  .inputs input, .inputs select {flex:1;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background: rgba(2,6,23,0.4); color:var(--white);outline:none;font-size:15px;}
  .inputs select{max-width:170px}
  .actions{display:flex;gap:10px;align-items:center}
  button.primary{flex:1;background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;padding:12px;border-radius:10px;color:#04263b;font-weight:700;cursor:pointer;font-size:15px;box-shadow:0 8px 30px rgba(59,130,246,0.12);}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--white);padding:10px 12px;border-radius:10px;cursor:pointer;}

  .hint{font-size:13px;color:var(--muted);margin-top:6px}

  .results{margin-top:20px;display:flex;flex-direction:column;gap:14px;}
  .summary{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);border:1px solid var(--glass-border);}
  .summary .logo-mini{width:48px;height:48px;border-radius:8px;background:rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;font-weight:700}
  .summary .meta h3{margin:0;font-size:16px}
  .summary .meta p{margin:2px 0 0;font-size:13px;color:var(--muted)}

  .timeline{display:flex;flex-direction:column;gap:10px;padding:8px;}
  .step{display:flex;gap:12px;align-items:flex-start;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid var(--glass-border);transition:transform .22s ease, box-shadow .22s ease;}
  .step:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(2,6,23,0.6)}
  .dot{min-width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#04263b;}
  .step .body{flex:1}
  .step .body .time{font-size:13px;color:var(--muted)}
  .step .body .txt{font-weight:700;margin-top:4px;color:var(--white)}

  .empty{padding:26px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px dashed rgba(255,255,255,0.03);text-align:center;color:var(--muted)}

  @media(max-width:980px){.hero{grid-template-columns:1fr; padding:22px}.wrap{padding:12px}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true">TP</div>
      <div>
        <h1 style="font-size:16px;margin:0">TrackPack</h1>
        <div style="font-size:12px;color:var(--muted)">Suivi universel</div>
      </div>
    </div>

    <div class="controls">
      <div class="lang-select" title="Choisir la langue">
        <i class="fa-solid fa-globe" style="opacity:.9"></i>
        <select id="langTop" aria-label="Langue">
          <option value="fr">FR</option>
          <option value="en">EN</option>
        </select>
      </div>
    </div>
  </header>

  <section class="hero" aria-labelledby="hero-title">
    <div class="hero-left">
      <div class="tag">Multi-transporteurs • Multilingue</div>
      <h2 id="hero-title">Suivez tous vos colis en temps réel</h2>
      <p id="hero-sub">Entrez votre numéro, choisissez un transporteur (ou auto) et obtenez l'historique en quelques secondes.</p>
      <div id="resultsWrap" class="results" aria-live="polite">
        <div class="empty" id="emptyMsg">Aucun suivi pour l'instant — essayez un numéro de test.</div>
      </div>
    </div>

    <aside>
      <div class="card" role="region" aria-label="Formulaire de suivi">
        <form id="trackForm" class="tracking" autocomplete="off">
          <div class="inputs">
            <input id="trackNumber" name="trackNumber" placeholder="Ex : 1Z999AA10123456784" aria-label="Numéro de suivi">
            <select id="carrierSelect" aria-label="Transporteur">
              <option value="">Détection automatique</option>
              <option value="dhl">DHL</option>
              <option value="ups">UPS</option>
              <option value="fedex">FedEx</option>
              <option value="laposte">La Poste</option>
            </select>
          </div>

          <div class="actions">
            <button type="submit" class="primary" id="btnTrack"><i class="fa-solid fa-magnifying-glass" style="margin-right:8px"></i>Suivre</button>
            <button type="button" id="btnSample" class="ghost" title="Exemple">Exemple</button>
          </div>

          <div class="hint" id="hintText">Supporte la détection automatique des transporteurs si disponible via ton API.</div>
        </form>
      </div>
    </aside>
  </section>
</div>

<script>
const LANG = {
  fr: { tracking:'Suivi', searching:'Recherche en cours…', noResults:"Aucun résultat trouvé.", enterNumber:"Veuillez saisir un numéro de suivi", sampleNumber:"1Z999AA10123456784"},
  en: { tracking:'Tracking', searching:'Searching…', noResults:"No results found.", enterNumber:"Please enter a tracking number", sampleNumber:"1Z999AA10123456784"}
};

let currentLang = 'fr';
const langTop = document.getElementById('langTop');
const resultsWrap = document.getElementById('resultsWrap');

langTop.addEventListener('change', e=>{
  currentLang = e.target.value;
  document.getElementById('btnTrack').innerHTML = `<i class="fa-solid fa-magnifying-glass" style="margin-right:8px"></i>${ currentLang==='fr'?'Suivre':'Track' }`;
  document.getElementById('hintText').textContent = currentLang==='fr'?"Supporte la détection automatique des transporteurs si disponible via ton API.":"Supports automatic carrier detection if available via your API.";
  document.getElementById('hero-title').textContent = currentLang==='fr'?'Suivez tous vos colis en temps réel':'Track all your packages in real time';
  document.getElementById('hero-sub').textContent = currentLang==='fr'?"Entrez votre numéro, choisissez un transporteur (ou auto) et obtenez l'historique en quelques secondes.":"Enter your number, choose a carrier (or auto) and get the history in seconds.";
});

function escapeHtml(s){return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');}

function clearResults(){resultsWrap.innerHTML='';}
function showEmpty(){clearResults(); const el=document.createElement('div'); el.className='empty'; el.textContent=currentLang==='fr'?"Aucun suivi pour l'instant — essayez un numéro de test.":"No tracking yet — try a sample number."; resultsWrap.appendChild(el);}

function renderTracking(data){
  clearResults();
  const summary=document.createElement('div'); summary.className='summary';
  summary.innerHTML=`<div class="logo-mini">${escapeHtml(data.carrierName.slice(0,2).toUpperCase())}</div>
    <div class="meta"><h3>${escapeHtml(data.carrierName)} · ${escapeHtml(data.trackingNumber)}</h3>
    <p>${currentLang==='fr'?'Dernière mise à jour':'Last update'}: ${escapeHtml(data.events[0]?.time || '')}</p></div>`;
  resultsWrap.appendChild(summary);
  const timeline=document.createElement('div'); timeline.className='timeline';
  data.events.slice().reverse().forEach((ev,idx)=>{const step=document.createElement('div');step.className='step';step.innerHTML=`<div class="dot">${idx+1}</div><div class="body"><div class="time">${escapeHtml(ev.time)}</div><div class="txt">${escapeHtml(ev.status)}</div></div>`;timeline.appendChild(step);});
  resultsWrap.appendChild(timeline);
}

const form=document.getElementById('trackForm');
const trackNumberInput=document.getElementById('trackNumber');
const carrierSelect=document.getElementById('carrierSelect');
const btnSample=document.getElementById('btnSample');

async function fetchTracking(number, carrier){
  const apiKey = 'asat_025c8097d5b94afc8ee1941f817a603b';
  const url = `https://api.aftership.com/v4/trackings`;
  const body = { tracking: { tracking_number:number, slug: carrier||null } };
  const resp = await fetch(url,{ method:'POST', headers:{ 'Content-Type':'application/json','aftership-api-key':apiKey }, body:JSON.stringify(body) });
  const data = await resp.json();
  if(!data.data.tracking) return null;
  return {
    carrierName: data.data.tracking.slug || carrier || 'Unknown',
    trackingNumber: data.data.tracking.tracking_number || number,
    events: (data.data.tracking.checkpoints||[]).map(e=>({time:e.checkpoint_time,status:e.message}))
  };
}

form.addEventListener('submit', async ev=>{
  ev.preventDefault();
  const number=trackNumberInput.value.trim();
  const carrier=carrierSelect.value;
  if(!number){ alert(LANG[currentLang].enterNumber); return; }
  clearResults();
  const loading=document.createElement('div'); loading.className='summary';
  loading.innerHTML=`<div style="width:48px;height:48px;border-radius:8px;background:rgba(255,255,255,0.02);display:flex;align-items:center;justify-content:center"><i class="fa-solid fa-spinner fa-spin" style="opacity:.7"></i></div>
    <div class="meta"><h3>${currentLang==='fr'?'Recherche':'Searching'}</h3><p style="color:var(--muted)">${escapeHtml(number)}</p></div>`;
  resultsWrap.appendChild(loading);

  try{
    const data = await fetchTracking(number, carrier||'');
    if(!data || !data.events || data.events.length===0){ clearResults(); const msg=document.createElement('div'); msg.className='empty'; msg.textContent=LANG[currentLang].noResults; resultsWrap.appendChild(msg); return; }
    renderTracking(data);
  }catch(err){ clearResults(); const errEl=document.createElement('div'); errEl.className='empty'; errEl.textContent=currentLang==='fr'?'Erreur lors de la requête. Réessayer plus tard.':'Request error. Try again later.'; resultsWrap.appendChild(errEl); console.error(err);}
});

btnSample.addEventListener('click', ()=>{ trackNumberInput.value=LANG[currentLang].sampleNumber; carrierSelect.value=''; trackNumberInput.focus(); });
showEmpty();
</script>
</body>
</html>
